{% extends 'base.html' %}

{% block conteudo %}

    {% if current_user.is_authenticated %}
    <div class="card shadow p-5 bg-dark text-white-50">
        <h4 class="text-white">Lista de Personagens</h4>
        <p>
            <strong class="text-white">Nome:</strong> Aristemy <strong class="text-white">Classe:</strong> Bladesinger <strong class="text-white">Raça:</strong> Alto Elfo <strong class="text-white">Nível:</strong> 13
        </p>
    </div>
    <br>

    <div class="card shadow p-5 bg-dark text-white-50">
        <h4 class="text-white">Criar Personagem</h4>
        <p>
            Formulário Aqui
        </p>
    </div>
    <br>

    <div class="card shadow p-5 bg-dark text-white-50">
        <h4 class="text-white">Lista de NPCs</h4>
        
        {% for npc in npcs %}
        <p> 
            <strong class="text-white">{{npc.ficha['nome']}} - {{npc.ficha['raca']}} - ND: {{npc.ficha['nd']}}</strong>
            <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal"> Vizualizar </button>
        </p>       
        
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-white">

                <div class="modal-body">
                    <h1> {{npc.ficha['nome']}} </h1>

                    <p><I>{{npc.ficha['raca']}}, {{npc.ficha['tamanho']}}, {{npc.ficha['tendencia']}} </I></p>
                    
                    <p><strong>CA:</strong> {{npc.ficha['ca']}} - <strong>Iniciativa:</strong> {{npc.ficha['atributos']['bdestreza']}} </p>                
                    <p> <strong>PV:</strong> {{npc.ficha['pv']}} <I>( {{npc.ficha['dadosvida']}} )</I> </p>
                    <p><strong>Movimento </strong> {{npc.ficha['speed']}}                         
                        {% if npc.ficha['voo'] %}
                          <strong> Vôo </strong> {{npc.ficha['voo']}}
                        {% endif %}
                        {% if npc.ficha['natacao'] %}
                         <strong> Natação:</strong> {{npc.ficha['natacao']}}
                       {% endif %}
                    </p>

                    <div class="row">
                        <!-- Coluna 1 -->
                        <div class="col-md-4">
                            <table class="table table-dark table-borderless">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th></th>
                                        <th>Mod</th>
                                        <th>Save</th> 
                                    </tr>
                                    <tr>
                                        <td><strong>FOR</strong></td>
                                        <td>{{npc.ficha['atributos']['forca']}}</td>
                                        <td>{{npc.ficha['atributos']['bforca']}}</td>
                                        <td>{{npc.ficha['atributos']['save_forca']}}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>INT</strong></td>
                                        <td>{{npc.ficha['atributos']['inteligência']}}</td>
                                        <td>{{npc.ficha['atributos']['binteligência']}}</td>
                                        <td>{{npc.ficha['atributos']['save_inteligencia']}}</td>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                        
                        <!-- Coluna 2 -->
                        <div class="col-md-4">
                            <table class="table table-dark table-borderless">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th></th>
                                        <th>Mod</th>
                                        <th>Save</th> 
                                    </tr>
                                    <tr>
                                        <td><strong>DES</strong></td>
                                        <td>{{npc.ficha['atributos']['destreza']}}</td>
                                        <td>{{npc.ficha['atributos']['bdestreza']}}</td>
                                        <td>{{npc.ficha['atributos']['save_destreza']}}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>SAB</strong></td>
                                        <td>{{npc.ficha['atributos']['sabedoria']}}</td>
                                        <td>{{npc.ficha['atributos']['bsabedoria']}}</td>
                                        <td>{{npc.ficha['atributos']['save_sabedoria']}}</td>
                                    </tr>
                                </thead>
        
                            </table>
                        </div>
                        
                        <!-- Coluna 3 -->
                        <div class="col-md-4">
                            <table class="table table-dark table-borderless">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th></th>
                                        <th>Mod</th>
                                        <th>Save</th> 
                                    </tr>
                                    <tr>
                                        <td><strong>CON</strong></td>
                                        <td>{{npc.ficha['atributos']['constituição']}}</td>
                                        <td>{{npc.ficha['atributos']['bconstituição']}}</td>
                                        <td>{{npc.ficha['atributos']['save_constituicao']}}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>CAR</strong></td>
                                        <td>{{npc.ficha['atributos']['carisma']}}</td>
                                        <td>{{npc.ficha['atributos']['bcarisma']}}</td>
                                        <td>{{npc.ficha['atributos']['save_carisma']}}</td>
                                    </tr>
                                </thead>
        
                            </table>                        
                        </div>
                    </div>
                    <p>
                    {% if npc.ficha['pericias_atuais'] %}                        
                    
                        <strong>Perícias:</strong>                        
                        {% for pericia in npc.ficha['pericias_atuais'] %}
                            {{ pericia['nome'] }} {{ pericia['valor'] }}{% if not loop.last %}, {% endif %}
                        {% endfor %}

                    {% endif %}
                    </p>
                    
                    <p>
                        <strong>Sentidos:</strong> 

                        {% set percepcao_valor = None %}
                        {% for pericia in npc.ficha['pericias_atuais'] %}
                            {% if pericia['nome'] == 'Percepção ' %}
                                {% set percepcao_valor = pericia['valor'] %}
                            {% endif %}
                        {% endfor %}
                        
                        {% if percepcao_valor is not none %}
                            Percepção Passiva {{ 10 + percepcao_valor }}
                        {% else %}
                            Percepção Passiva {{ 10 + npc.ficha['atributos']['bsabedoria'] }}
                        {% endif %}
                    
                        {% if npc.ficha['darkvision'] %}
                            , Visão no escuro {{npc.ficha['darkvision']}}'
                        {% endif %}
                    </p>
                    <p><strong>ND:</strong> {{npc.ficha['nd']}} ({{npc.ficha['xp']}})- <strong>Proeficiência </strong>+ {{npc.ficha['proef']}}  </p>

                    
                    {% if npc.ficha['habilidades_atuais'] %}
                        <h3>Habilidades</h3>
                        <hr>
                        {% for habilidade in npc.ficha['habilidades_atuais'] %}
                        <p> <strong>{{habilidade['nome'] }}</strong> {{ habilidade['descricao'] }}</p>
                        {% endfor %}
                    {% endif %}


                    {% if npc.ficha['reacoes_atuais'] %}
                        <h3>Reações</h3>
                        <hr>
                        {% for habilidade in npc.ficha['reacoes_atuais'] %}
                        <p> <strong>{{habilidade['nome'] }}</strong> {{ habilidade['descricao'] }}</p>
                        {% endfor %}
                    {% endif %}

                    <h3>Ações</h3>
                    <hr>
                    {% if npc.ficha['acoes_atuais'] %}
                        {% for habilidade in npc.ficha['acoes_atuais'] %}
                        <p> <strong>{{habilidade['nome'] }}</strong> {{ habilidade['descricao'] }}</p>
                        {% endfor %}
                    {% endif %}
                    
                    {% if npc.ficha['ataques_atuais'] %}
                    {% for ataque in npc.ficha['ataques_atuais'] %}
                        <p>
                            <strong>{{ ataque['nome'] }}</strong> +{{ npc.ficha['proef'] + ((npc.ficha['atributos'][ataque['bonus']] - 10) // 2) }} 
                            Ataque {{ ataque['tipo'] }} Alcance {{ ataque['alcance'] }}. Acerto {{ ataque['dano'] }} 
                            ({{ ataque['dado'] }} + bônus de {{ ataque['bonus'] }}) {{ ataque['tipodano'] }} {{ ataque['extra'] }}
                        </p>
                    {% endfor %}
                {% endif %}

                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
            </div>
        </div>

        {% endfor %}  

    </div>
    <br>

    {% endif %}

{% endblock %}
